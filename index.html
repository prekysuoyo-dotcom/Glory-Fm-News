<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; color: #333; }
    .header { background: #003366; color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
    .container { max-width: 800px; margin: auto; padding: 10px; }
    .card { background: white; border-radius: 8px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .card img { width: 100%; height: auto; display: block; }
    .card-content { padding: 15px; }
    .category { color: #bb1919; font-weight: bold; text-transform: uppercase; font-size: 12px; }
    h2 { margin: 10px 0; font-size: 20px; line-height: 1.3; }
    .meta { font-size: 12px; color: #777; margin-bottom: 10px; }
    .body-text { font-size: 15px; line-height: 1.6; color: #444; }
    
    /* Sharing Section */
    .share-bar { border-top: 1px solid #eee; padding: 10px 15px; display: flex; justify-content: space-between; align-items: center; background: #fafafa; }
    .btn-share { background: #25D366; color: white; border: none; padding: 8px 15px; border-radius: 5px; font-weight: bold; cursor: pointer; text-decoration: none; font-size: 14px; }
    .btn-share i { margin-right: 5px; }
  </style>
</head>
<body>

  <div class="header">
    <h3>Glory FM 97.1 News Hub</h3>
  </div>

  <div class="container" id="news-container">
    </div>

<script>
  // 1. SETTINGS: Your Bridge URL
  const GITHUB_BRIDGE = "https://prekysuoyo-dotcom.github.io/Glory-Fm-News/";

  // 2. DATA: Passed from Code.gs
  const news = <?!= newsData ?>;
  const currentStorySlug = "<?= storySlug ?>";

  function renderNews() {
    const container = document.getElementById('news-container');
    
    // Sort so the requested story appears first
    let sortedNews = [...news];
    if (currentStorySlug) {
      const index = sortedNews.findIndex(s => s.slug === currentStorySlug);
      if (index > -1) {
        const topStory = sortedNews.splice(index, 1)[0];
        sortedNews.unshift(topStory);
      }
    }

    container.innerHTML = sortedNews.map(item => {
      // GENERATE THE AUTOMATIC BRIDGE LINK
      const titleEncoded = encodeURIComponent(item.caption);
      const imgEncoded = encodeURIComponent(item.image);
      const shareUrl = `${GITHUB_BRIDGE}?story=${item.slug}&title=${titleEncoded}&img=${imgEncoded}`;
      
      const whatsappText = encodeURIComponent(`*Radio Bayelsa Glory FM 97.1*\n\n${item.caption}\n\nRead more at: `) + shareUrl;

      return `
        <div class="card" id="${item.slug}">
          <img src="${item.image}" alt="news">
          <div class="card-content">
            <span class="category">${item.category}</span>
            <h2>${item.caption}</h2>
            <div class="meta">
              <i class="fa fa-user"></i> ${item.reporter} &nbsp;|&nbsp; 
              <i class="fa fa-calendar"></i> ${item.date}
            </div>
            <div class="body-text">${item.body}</div>
          </div>
          <div class="share-bar">
            <span>Share this story:</span>
            <a href="https://api.whatsapp.com/send?text=${whatsappText}" target="_blank" class="btn-share">
              <i class="fab fa-whatsapp"></i> WhatsApp
            </a>
          </div>
        </div>
      `;
    }).join('');

    // If we came from a share link, scroll to that story
    if (currentStorySlug) {
      setTimeout(() => {
        document.getElementById(currentStorySlug)?.scrollIntoView({ behavior: 'smooth' });
      }, 500);
    }
  }

  renderNews();
</script>
</body>
</html>
